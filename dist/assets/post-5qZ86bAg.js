import{v as re,a9 as te,_ as P,r as a,w as de,b as pe,aa as ue,T as h,j as t,d as me,h as xe,ab as ye,k as be,t as je,N as E,O as v,B as C,F as he,P as F,Q as se,R as _,V as W,U as V,ac as O,M as ne,W as ae,L as ie,ad as Ce,ae as ve,X as Ie,Y as ke,Z as Pe,$ as le,a0 as oe,a1 as Se,a2 as Te,J as Ae,E as Re,C as Le,a3 as Ue,a4 as Ne,a5 as Me,a6 as z,a7 as $e,a8 as We,H as De}from"./index-XpIIWU6J.js";import{C as Oe}from"./config-global-CsQpxj4K.js";const Ee=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],Fe=e=>{const{classes:s,inset:n,primary:c,secondary:m,dense:x}=e;return xe({root:["root",n&&"inset",x&&"dense",c&&m&&"multiline"],primary:["primary"],secondary:["secondary"]},ye,s)},_e=re("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[{[`& .${te.primary}`]:s.primary},{[`& .${te.secondary}`]:s.secondary},s.root,n.inset&&s.inset,n.primary&&n.secondary&&s.multiline,n.dense&&s.dense]}})(({ownerState:e})=>P({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},e.primary&&e.secondary&&{marginTop:6,marginBottom:6},e.inset&&{paddingLeft:56})),Ve=a.forwardRef(function(s,n){const c=de({props:s,name:"MuiListItemText"}),{children:m,className:x,disableTypography:d=!1,inset:p=!1,primary:f,primaryTypographyProps:u,secondary:I,secondaryTypographyProps:S}=c,T=pe(c,Ee),{dense:y}=a.useContext(ue);let g=f??m,l=I;const o=P({},c,{disableTypography:d,inset:p,primary:!!g,secondary:!!l,dense:y}),r=Fe(o);return g!=null&&g.type!==h&&!d&&(g=t.jsx(h,P({variant:y?"body2":"body1",className:r.primary,component:u!=null&&u.variant?void 0:"span",display:"block"},u,{children:g}))),l!=null&&l.type!==h&&!d&&(l=t.jsx(h,P({variant:"body2",className:r.secondary,color:"text.secondary",display:"block"},S,{children:l}))),t.jsxs(_e,P({className:me(r.root,x),ownerState:o,ref:n},T,{children:[g,l]}))});function ze(e){return be("MuiListItemAvatar",e)}je("MuiListItemAvatar",["root","alignItemsFlexStart"]);const Be=["className"],He=e=>{const{alignItems:s,classes:n}=e;return xe({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},ze,n)},Qe=re("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,n.alignItems==="flex-start"&&s.alignItemsFlexStart]}})(({ownerState:e})=>P({minWidth:56,flexShrink:0},e.alignItems==="flex-start"&&{marginTop:8})),Ye=a.forwardRef(function(s,n){const c=de({props:s,name:"MuiListItemAvatar"}),{className:m}=c,x=pe(c,Be),d=a.useContext(ue),p=P({},c,{alignItems:d.alignItems}),f=He(p);return t.jsx(Qe,P({className:me(f.root,m),ownerState:p,ref:n},x))});function Ge({searchQuery:e,...s}){return t.jsx(E,{...s,children:t.jsx(v,{align:"center",colSpan:7,children:t.jsxs(C,{sx:{py:15,textAlign:"center"},children:[t.jsx(h,{variant:"h6",sx:{mb:1},children:"Not found"}),t.jsxs(h,{variant:"body2",children:["No results found for  ",t.jsxs("strong",{children:['"',e,'"']}),".",t.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function Je({row:e,selected:s,onSelectRow:n,onDeletePost:c}){var B,H,Q,Y,G,J,X,Z,q,K,w,ee;const[m,x]=a.useState(null),[d,p]=a.useState(!1);a.useState(e.content);const[f,u]=a.useState(null),[I,S]=a.useState(!1),[T,y]=a.useState(!1),g=()=>{L(),p(!1)},l=()=>p(!0);a.useState(null),a.useState(null);const o=i=>{u(i),S(!0)},r=()=>{S(!1),u(null)},A=()=>{console.log("Opening voted users modal..."),console.log("Row votes:",e==null?void 0:e.votes),console.log("File type:",e==null?void 0:e.fileType),y(!0)},R=()=>{y(!1)},D=a.useCallback(i=>{x(i.currentTarget)},[]),L=a.useCallback(()=>{x(null)},[]),ge=a.useCallback(async i=>{if(window.confirm("Are you sure you want to delete the post"))try{const k=await he.delete(`/api/post?id=${i}`);c(i)}catch(k){console.error("Error deleting post:",k)}},[c]);return t.jsxs(t.Fragment,{children:[t.jsxs(F,{open:d,onClose:g,fullWidth:!0,maxWidth:"sm",children:[t.jsx(se,{sx:{textAlign:"center",fontWeight:"bold",fontSize:"1.5rem"},children:"👁️ View Post"}),t.jsxs(_,{dividers:!0,sx:{overflowY:"auto",maxHeight:"600px","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",px:3,py:4},children:[t.jsx(C,{sx:{display:"flex",justifyContent:"center",mb:3},children:((H=(B=e==null?void 0:e.files)==null?void 0:B[0])==null?void 0:H.type)==="video"?t.jsx(C,{component:"video",src:`${W}${(Y=(Q=e==null?void 0:e.files)==null?void 0:Q[0])==null?void 0:Y.file}`,controls:!0,preload:"metadata",onError:i=>{const b=i.target;b.style.display="none"},sx:{width:160,height:160,borderRadius:2,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1},"&::-webkit-media-controls":{display:"none"}}}):t.jsx(V,{src:`${W}${(J=(G=e==null?void 0:e.files)==null?void 0:G[0])==null?void 0:J.file}`,alt:"Post Image",variant:"rounded",sx:{width:160,height:160,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}}})}),t.jsx(h,{variant:"subtitle1",fontWeight:"bold",mb:1,children:"Content:"}),t.jsx(h,{variant:"body1",mb:3,children:e.content||"N/A"}),t.jsx(C,{sx:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:2,backgroundColor:"#f5f5f5",borderRadius:2,p:3,boxShadow:1},children:(()=>{var b,k,U,N,M,$;return[{icon:"mdi:tag-outline",label:"Category",value:(typeof(e==null?void 0:e.categoryId)=="object"?(b=e==null?void 0:e.categoryId)==null?void 0:b.name:e==null?void 0:e.categoryId)||"N/A",isClickable:!1,onClick:void 0},{icon:"mdi:earth",label:"Country",value:e!=null&&e.country&&(e==null?void 0:e.country.trim())!==""?e==null?void 0:e.country:"N/A",isClickable:!1,onClick:void 0},{icon:"mdi:account",label:"Name",value:((k=e==null?void 0:e.userId)==null?void 0:k.name)||"N/A",isClickable:!1,onClick:void 0},...e.startTime?[{icon:"mdi:clock-start",label:"Start Time",value:O(new Date(e==null?void 0:e.startTime),"PPpp"),isClickable:!1,onClick:void 0}]:[],...e.endTime?[{icon:"mdi:clock-end",label:"End Time",value:O(new Date(e==null?void 0:e.endTime),"PPpp"),isClickable:!1,onClick:void 0}]:[],...e.duration?[{icon:"mdi:timer-outline",label:"Duration",value:`${e==null?void 0:e.duration} seconds`,isClickable:!1,onClick:void 0}]:[],{icon:"mdi:eye-outline",label:(e==null?void 0:e.fileType)==="poll"?"Voted Users":"Watched Users",value:(e==null?void 0:e.fileType)==="poll"?((U=e==null?void 0:e.votes)==null?void 0:U.length)??0:((N=e==null?void 0:e.watchedUsers)==null?void 0:N.length)??0,isClickable:(e==null?void 0:e.fileType)==="poll"&&(((M=e==null?void 0:e.votes)==null?void 0:M.length)??0)>0,onClick:(e==null?void 0:e.fileType)==="poll"&&((($=e==null?void 0:e.votes)==null?void 0:$.length)??0)>0?A:void 0},{icon:"mdi:calendar-plus",label:"Created At",value:O(new Date(e==null?void 0:e.createdAt),"PP"),isClickable:!1,onClick:void 0}].map((j,fe)=>t.jsxs(C,{display:"flex",alignItems:"center",gap:1,children:[t.jsx(ne,{icon:j.icon,width:20,color:"text.secondary"}),t.jsxs(h,{variant:"subtitle2",color:"text.secondary",children:[j.label,":"]}),t.jsx(h,{variant:"body2",color:j.isClickable?"primary.main":"text.primary",sx:{gridColumn:"span 2",cursor:j.isClickable?"pointer":"default",textDecoration:j.isClickable?"underline":"none","&:hover":j.isClickable?{color:"primary.dark"}:{}},onClick:j.onClick||void 0,children:String(j.value)})]},fe))})()})]}),t.jsx(ae,{sx:{justifyContent:"center",pb:2},children:t.jsx(ie,{onClick:g,color:"primary",variant:"outlined",children:"Close"})})]}),t.jsxs(F,{open:T,onClose:R,fullWidth:!0,maxWidth:"sm",children:[t.jsxs(se,{sx:{textAlign:"center",fontWeight:"bold",fontSize:"1.5rem"},children:["👥 Voted Users (",((X=e==null?void 0:e.votes)==null?void 0:X.length)??0,")"]}),t.jsx(_,{dividers:!0,sx:{p:0},children:((Z=e==null?void 0:e.votes)==null?void 0:Z.length)>0?t.jsx(Ce,{sx:{width:"100%",bgcolor:"background.paper"},children:(q=e==null?void 0:e.votes)==null?void 0:q.map((i,b)=>{var k,U,N,M,$,j;return t.jsxs(ve,{sx:{borderBottom:b<e.votes.length-1?"1px solid #f0f0f0":"none",py:2},children:[t.jsx(Ye,{children:t.jsx(V,{src:(k=i==null?void 0:i.userId)!=null&&k.image?`${W}${i.userId.image}`:void 0,sx:{width:50,height:50},children:((M=(N=(U=i==null?void 0:i.userId)==null?void 0:U.name)==null?void 0:N.charAt(0))==null?void 0:M.toUpperCase())||"U"})}),t.jsx(Ve,{primary:t.jsx(h,{variant:"subtitle1",fontWeight:"bold",children:(($=i==null?void 0:i.userId)==null?void 0:$.name)||"Unknown User"}),secondary:t.jsxs(C,{children:[t.jsx(h,{variant:"body2",color:"text.secondary",children:((j=i==null?void 0:i.userId)==null?void 0:j.email)||"No email"}),(i==null?void 0:i.option)&&t.jsxs(h,{variant:"caption",color:"primary.main",sx:{fontWeight:"bold"},children:["Voted for: ",i.option.name]})]})})]},i._id||b)})}):t.jsx(C,{sx:{textAlign:"center",py:4},children:t.jsx(h,{variant:"h6",color:"text.secondary",children:"No votes yet"})})}),t.jsx(ae,{sx:{justifyContent:"center",pb:2},children:t.jsx(ie,{onClick:R,color:"primary",variant:"outlined",children:"Close"})})]}),t.jsxs(E,{hover:!0,tabIndex:-1,role:"checkbox",selected:s,children:[t.jsx(v,{padding:"checkbox"}),t.jsx(v,{component:"th",scope:"row",children:t.jsx(C,{gap:2,display:"flex",alignItems:"center",children:t.jsx(C,{sx:{width:40,height:40,borderRadius:"50%",overflow:"visible",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}},onClick:()=>{var i,b;return o(`${W}${(b=(i=e.files)==null?void 0:i[0])==null?void 0:b.file}`)},children:t.jsx(V,{src:`${W}${(w=(K=e==null?void 0:e.files)==null?void 0:K[0])==null?void 0:w.file}`,sx:{width:"120%",height:"120%"}})})})}),t.jsx(v,{children:(e==null?void 0:e.fileType)||"N/A"}),t.jsx(v,{children:(e==null?void 0:e.content.slice(0,30))||"N/A"}),t.jsx(v,{children:((ee=e==null?void 0:e.userId)==null?void 0:ee.name)||"N/A"}),t.jsx(v,{children:O(new Date(e==null?void 0:e.createdAt),"PP")}),t.jsx(v,{align:"right",children:t.jsx(Ie,{onClick:D,children:t.jsx(ne,{icon:"eva:more-vertical-fill"})})})]}),t.jsx(ke,{open:!!m,anchorEl:m,onClose:L,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsxs(Pe,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${le.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${le.selected}`]:{bgcolor:"action.selected"}}},children:[t.jsx(oe,{onClick:l,children:"View Details"}),t.jsx(oe,{onClick:()=>ge(e==null?void 0:e._id),sx:{color:"error.main"},children:"Delete"})]})}),t.jsx(F,{open:I,onClose:r,maxWidth:"md",fullWidth:!0,children:t.jsx(_,{sx:{p:0,bgcolor:"black"},children:t.jsx("img",{src:f||void 0,alt:"Post Preview",style:{width:"100%",maxHeight:"80vh",objectFit:"contain",display:"block",margin:"auto"},onClick:r})})})]})}const Xe={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Ze(e,s,n){return e?Math.max(0,(1+e)*s-n):0}function ce(e,s,n){return s[n]<e[n]?-1:s[n]>e[n]?1:0}function qe(e,s){return e==="desc"?(n,c)=>ce(n,c,s):(n,c)=>-ce(n,c,s)}function Ke({inputData:e,comparator:s,filterName:n}){const c=e.map((m,x)=>[m,x]);return c.sort((m,x)=>{const d=s(m[0],x[0]);return d!==0?d:m[1]-x[1]}),e=c.map(m=>m[0]),n&&(e=e.filter(m=>m.name.toLowerCase().indexOf(n.toLowerCase())!==-1)),e}function we({order:e,onSort:s,orderBy:n,rowCount:c,headLabel:m,numSelected:x,onSelectAllRows:d}){return t.jsx(Se,{children:t.jsxs(E,{children:[t.jsx(v,{padding:"checkbox"}),m.map(p=>t.jsx(v,{align:p.align||"left",sortDirection:n===p.id?e:!1,sx:{width:p.width,minWidth:p.minWidth},children:t.jsxs(Te,{hideSortIcon:!0,active:n===p.id,direction:n===p.id?e:"asc",onClick:()=>s(p.id),children:[p.label,n===p.id?t.jsx(C,{sx:{...Xe},children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},p.id))]})})}function et({emptyRows:e,height:s,sx:n,...c}){return e?t.jsx(E,{sx:{...s&&{height:s*e},...n},...c,children:t.jsx(v,{colSpan:9})}):null}function tt(){const[e,s]=a.useState([]),[n,c]=a.useState(0),[m,x]=a.useState(!1),[d,p]=a.useState({limit:10,page:0}),f=async(l,o)=>{var A,R,D,L;const r=await he.get(`/admin/getAllPost?limit=${l}&page=${o+1}`);s((R=(A=r==null?void 0:r.data)==null?void 0:A.data)==null?void 0:R.response),c((L=(D=r==null?void 0:r.data)==null?void 0:D.data)==null?void 0:L.total)};a.useEffect(()=>{f(d.limit,d.page)},[d.limit,d.page]);const u=st(),[I,S]=a.useState("");if(m)return t.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:t.jsx(Ae,{})});const y=!Ke({inputData:e,comparator:qe(u.order,u.orderBy),filterName:I}).length&&!!I,g=l=>{s(o=>o.filter(r=>r._id!==l))};return t.jsx(Re,{children:t.jsxs(Le,{children:[t.jsx(Ue,{children:t.jsx(Ne,{sx:{overflow:"unset"},children:t.jsxs(Me,{sx:{minWidth:800},children:[t.jsx(we,{order:u.order,orderBy:u.orderBy,rowCount:z.length,numSelected:u.selected.length,onSort:u.onSort,onSelectAllRows:l=>u.onSelectAllRows(l,z.map(o=>o.id)),headLabel:[{id:"files",label:"Image"},{id:"type",label:"Type"},{id:"content",label:"Content"},{id:"username",label:"Username"},{id:"createdAt",label:"Create Time"},{id:""}]}),t.jsxs($e,{children:[e.map(l=>t.jsx(Je,{row:l,selected:u.selected.includes(l==null?void 0:l._id),onSelectRow:()=>u.onSelectRow(l==null?void 0:l._id),onDeletePost:g},l==null?void 0:l._id)),t.jsx(et,{height:68,emptyRows:Ze(u.page,u.rowsPerPage,z.length)}),y&&t.jsx(Ge,{searchQuery:I})]})]})})}),t.jsx(We,{component:"div",page:d.page,count:n,rowsPerPage:d.limit,onPageChange:(l,o)=>{p(r=>({...r,page:o})),u.setPage(o)},rowsPerPageOptions:[5,10,25],onRowsPerPageChange:l=>{var r;const o=parseInt(l.target.value,10);p({page:0,limit:o}),(r=u.setRowsPerPage)==null||r.call(u,o)}})]})})}function st(){const[e,s]=a.useState(0),[n,c]=a.useState("name"),[m,x]=a.useState(5),[d,p]=a.useState([]),[f,u]=a.useState("asc"),I=a.useCallback(o=>{u(n===o&&f==="asc"?"desc":"asc"),c(o)},[f,n]),S=a.useCallback((o,r)=>{if(o){p(r);return}p([])},[]),T=a.useCallback(o=>{const r=d.includes(o)?d.filter(A=>A!==o):[...d,o];p(r)},[d]),y=a.useCallback(()=>{s(0)},[]),g=a.useCallback((o,r)=>{s(r)},[]),l=a.useCallback(o=>{x(parseInt(o.target.value,10)),y()},[y]);return{page:e,order:f,onSort:I,orderBy:n,selected:d,rowsPerPage:m,onSelectRow:T,onResetPage:y,onChangePage:g,onSelectAllRows:S,onChangeRowsPerPage:l,setPage:s,setRowsPerPage:x}}function it(){return t.jsxs(t.Fragment,{children:[t.jsx(De,{children:t.jsxs("title",{children:[" ",`Users - ${Oe.appName}`]})}),t.jsx(tt,{})]})}export{it as default};
