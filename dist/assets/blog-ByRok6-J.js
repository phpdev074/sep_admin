import{r as s,j as e,E as fe,B as l,G as pe,I as J,T as o,J as A,K as h,L as w,F as m,M as K,H as Ce}from"./index-Cp-PRQmd.js";import{C as we}from"./config-global-CsQpxj4K.js";function je(){const[u,M]=s.useState("settings");s.useState(!1),s.useState(void 0),s.useState("");const[g,E]=s.useState(""),[x,T]=s.useState(""),[_,P]=s.useState(""),[q,I]=s.useState(""),[Q,N]=s.useState(!0),[B,F]=s.useState(""),[W,z]=s.useState(!1),[c,$]=s.useState(""),[X,L]=s.useState(!1),[U,j]=s.useState(""),[V,Y]=s.useState(!1),[D,S]=s.useState(!1),[f,y]=s.useState(30),[p,v]=s.useState(5),[Z,b]=s.useState(30),[ee,k]=s.useState(5),[te,H]=s.useState(!1),[R,O]=s.useState(!1),[G,C]=s.useState(""),[se,ae]=s.useState(0),[ne,re]=s.useState(""),[oe,ie]=s.useState(0),[le,ce]=s.useState(0),de=()=>{const a=new CustomEvent("adminUpdated");window.dispatchEvent(a)};s.useEffect(()=>{(async()=>{var r,n,d;N(!0),F("");try{const i=localStorage.getItem("token");if(!i)throw new Error("No auth token found");const t=(r=(await m.get("/admin/getAdmin",{headers:{Authorization:`Bearer ${i}`}})).data)==null?void 0:r.data;E(t.name||""),T(t.email||""),P(t.name||""),I(t.email||""),y(t==null?void 0:t.commission),v(t==null?void 0:t.transactionCharge),b(t==null?void 0:t.commission),k(t==null?void 0:t.transactionCharge),ae((t==null?void 0:t.walletTokens)??0),re((t==null?void 0:t.currency)??""),ie((t==null?void 0:t.tokenValue)??0),ce((t==null?void 0:t.walletBalance)??0)}catch(i){F(((d=(n=i.response)==null?void 0:n.data)==null?void 0:d.message)||i.message||"Failed to load admin data")}finally{N(!1)}})()},[]),s.useEffect(()=>{u==="charges"&&(async()=>{var r,n,d;H(!0),C("");try{const i=localStorage.getItem("token");if(!i)throw new Error("No auth token found");const t=(r=(await m.get("/admin/getAdmin",{headers:{Authorization:`Bearer ${i}`}})).data)==null?void 0:r.data;y(t==null?void 0:t.commission),v(t==null?void 0:t.transactionCharge),b(t==null?void 0:t.commission),k(t==null?void 0:t.transactionCharge)}catch(i){C(((d=(n=i.response)==null?void 0:n.data)==null?void 0:d.message)||i.message||"Failed to load charges")}finally{H(!1)}})()},[u]);const he=(a,r)=>{M(r)},me=async()=>{var a,r;O(!0),C("");try{const n=localStorage.getItem("token");if(!n)throw new Error("No auth token found");await m.put("/admin/editAdmin",{commission:f,transactionCharge:p},{headers:{Authorization:`Bearer ${n}`}}),b(f),k(p)}catch(n){C(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||n.message||"Failed to update charges")}finally{O(!1)}},ue=f!==Z||p!==ee,ge=()=>e.jsxs(l,{sx:{width:400,p:3,borderRadius:2,boxShadow:2,backgroundColor:"#f9f9f9",display:"flex",flexDirection:"column",gap:3,marginLeft:"371px"},children:[e.jsx(o,{variant:"h6",mb:1,children:"Charges Settings"}),te?e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:100,children:e.jsx(A,{})}):G?e.jsx(o,{color:"error",children:G}):e.jsxs(e.Fragment,{children:[e.jsx(h,{label:"Commission Charge (%)",type:"number",inputProps:{min:0,max:100,step:.1},value:f,onChange:a=>y(parseFloat(a.target.value)),fullWidth:!0}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Commission charge applied on each transaction"}),e.jsx(h,{label:"Transaction Charge (%)",type:"number",inputProps:{min:0,max:100,step:.1},value:p,onChange:a=>v(parseFloat(a.target.value)),fullWidth:!0}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Transaction charge applied on each withdrawal"}),e.jsxs(l,{sx:{mt:-4,p:1,borderRadius:1},children:[e.jsxs(o,{variant:"subtitle2",color:"text.secondary",children:["Wallet Tokens: ",e.jsx("strong",{children:se})]}),e.jsxs(o,{variant:"subtitle2",color:"text.secondary",children:["Currency: ",e.jsx("strong",{children:ne})]}),e.jsxs(o,{variant:"subtitle2",color:"text.secondary",children:["Token Value: ",e.jsx("strong",{children:oe})]}),e.jsxs(o,{variant:"subtitle2",color:"text.secondary",children:["Wallet Balance: ",e.jsx("strong",{children:le})]})]}),e.jsx(w,{variant:"contained",onClick:me,disabled:R||!ue,sx:{alignSelf:"flex-end",width:"350px"},children:R?"Saving...":"Save Charges"})]})]});return e.jsxs(fe,{children:[e.jsx(l,{sx:{width:"100%",mb:3},children:e.jsxs(pe,{value:u,onChange:he,centered:!0,children:[e.jsx(J,{label:"Settings",value:"settings"}),e.jsx(J,{label:"Charges",value:"charges"})]})}),u==="settings"?e.jsx(l,{display:"flex",flexDirection:"column",alignItems:"center",mb:5,children:e.jsxs(l,{sx:{width:400,p:2,mb:4,borderRadius:2,boxShadow:2,backgroundColor:"#f9f9f9",display:"flex",flexDirection:"column",gap:2},children:[e.jsx(o,{variant:"h6",children:"Admin Info"}),Q?e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:100,children:e.jsx(A,{})}):B?e.jsx(o,{color:"error",children:B}):e.jsxs(e.Fragment,{children:[e.jsx(h,{label:"Name",value:g,fullWidth:!0,onChange:a=>E(a.target.value)}),e.jsx(h,{label:"Email",value:x,fullWidth:!0,onChange:a=>T(a.target.value)}),(g!==_||x!==q)&&e.jsx(w,{variant:"contained",onClick:async()=>{var a,r;z(!0);try{const n=localStorage.getItem("token");if(!n)throw new Error("No auth token found");await m.put("/admin/editAdmin",{name:g,email:x},{headers:{Authorization:`Bearer ${n}`}}),P(g),I(x),de()}catch(n){alert(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||n.message||"Failed to update admin info")}finally{z(!1)}},disabled:W,sx:{alignSelf:"flex-end",mt:1},children:W?"Saving...":"Save"}),e.jsx(o,{variant:"subtitle1",mt:3,children:"Change Password"}),e.jsx(h,{label:"New Password",type:V?"text":"password",value:c,onChange:a=>$(a.target.value),fullWidth:!0,size:"small",InputProps:{endAdornment:e.jsx(w,{onClick:()=>Y(a=>!a),size:"small",sx:{minWidth:"auto",ml:1},children:V?e.jsx(K,{icon:"eva:eye-off-fill",width:20}):e.jsx(K,{icon:"eva:eye-fill",width:20})})}}),U&&e.jsx(o,{color:"error",variant:"body2",children:U}),X&&e.jsx(o,{color:"success.main",variant:"body2",children:"Password updated successfully!"}),e.jsx(w,{variant:"contained",size:"small",sx:{mt:1},onClick:async()=>{var a,r;j(""),S(!0);try{const n=localStorage.getItem("token");if(!n)throw new Error("No auth token found");if(!c||c.length<6){j("Password must be at least 6 characters long."),S(!1);return}await m.put("/admin/editAdmin",{password:c},{headers:{Authorization:`Bearer ${n}`}}),L(!0),$(""),setTimeout(()=>L(!1),3e3)}catch(n){j(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||n.message)}finally{S(!1)}},disabled:!c||D,children:D?e.jsx(A,{size:20,color:"inherit"}):"Update Password"})]})]})}):ge()]})}function ve(){return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{children:e.jsxs("title",{children:[" ",`Blog - ${we.appName}`]})}),e.jsx(je,{})]})}export{ve as default};
