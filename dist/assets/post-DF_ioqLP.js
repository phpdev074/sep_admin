import{j as t,P as I,Q as p,B as b,T as C,r as l,F as X,L as Q,M as Z,N as V,U as k,R as q,a7 as A,K as G,O as w,J as ee,V as te,W as ne,X as se,Y as K,Z as Y,$ as ae,a0 as le,A as ie,G as oe,E as ce,C as re,a1 as de,a2 as ue,a3 as he,a4 as R,a5 as xe,a6 as ge,H as me}from"./index-C2XqsFAq.js";import{C as pe}from"./config-global-BrWtFIcI.js";function be({searchQuery:e,...a}){return t.jsx(I,{...a,children:t.jsx(p,{align:"center",colSpan:7,children:t.jsxs(b,{sx:{py:15,textAlign:"center"},children:[t.jsx(C,{variant:"h6",sx:{mb:1},children:"Not found"}),t.jsxs(C,{variant:"body2",children:["No results found for  ",t.jsxs("strong",{children:['"',e,'"']}),".",t.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function je({row:e,selected:a,onSelectRow:n,onDeletePost:u}){var D,N,O,$,E,M,W,F,U,L,_,z,H;const[d,g]=l.useState(null),[h,c]=l.useState(!1);l.useState(e.content);const[o,j]=l.useState(null),[T,S]=l.useState(!1),v=()=>{x(),c(!1)},f=()=>c(!0);l.useState(null),l.useState(null);const s=i=>{j(i),S(!0)},m=()=>{S(!1),j(null)},r=l.useCallback(i=>{g(i.currentTarget)},[]),x=l.useCallback(()=>{g(null)},[]),P=l.useCallback(async i=>{if(window.confirm("Are you sure you want to delete the post"))try{const B=await X.delete(`/api/post?id=${i}`);u(i)}catch(B){console.error("Error deleting post:",B)}},[u]);return t.jsxs(t.Fragment,{children:[t.jsxs(Q,{open:h,onClose:v,fullWidth:!0,maxWidth:"sm",children:[t.jsx(Z,{sx:{textAlign:"center",fontWeight:"bold",fontSize:"1.5rem"},children:"👁️ View Post"}),t.jsxs(V,{dividers:!0,sx:{overflowY:"auto",maxHeight:"600px","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",px:3,py:4},children:[t.jsx(b,{sx:{display:"flex",justifyContent:"center",mb:3},children:((N=(D=e==null?void 0:e.files)==null?void 0:D[0])==null?void 0:N.type)==="video"?t.jsx(b,{component:"video",src:`${k}${($=(O=e.files)==null?void 0:O[0])==null?void 0:$.file}`,controls:!0,preload:"metadata",onError:i=>{const y=i.target;y.style.display="none"},sx:{width:160,height:160,borderRadius:2,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1},"&::-webkit-media-controls":{display:"none"}}}):t.jsx(q,{src:`${k}${(M=(E=e==null?void 0:e.files)==null?void 0:E[0])==null?void 0:M.file}`,alt:"Post Image",variant:"rounded",sx:{width:160,height:160,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}}})}),t.jsx(C,{variant:"subtitle1",fontWeight:"bold",mb:1,children:"Content:"}),t.jsx(C,{variant:"body1",mb:3,children:e.content||"N/A"}),t.jsx(b,{sx:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:2,backgroundColor:"#f5f5f5",borderRadius:2,p:3,boxShadow:1},children:[{icon:"mdi:tag-outline",label:"Category",value:((W=e==null?void 0:e.categoryId)==null?void 0:W.name)||(e==null?void 0:e.categoryId)},{icon:"mdi:earth",label:"Country",value:e!=null&&e.country&&(e==null?void 0:e.country.trim())!==""?e==null?void 0:e.country:"N/A"},{icon:"mdi:account",label:"Name",value:((F=e==null?void 0:e.userId)==null?void 0:F.name)||"N/A"},e.startTime&&{icon:"mdi:clock-start",label:"Start Time",value:A(new Date(e==null?void 0:e.startTime),"PPpp")},e.endTime&&{icon:"mdi:clock-end",label:"End Time",value:A(new Date(e==null?void 0:e.endTime),"PPpp")},e.duration&&{icon:"mdi:timer-outline",label:"Duration",value:`${e==null?void 0:e.duration} seconds`},{icon:"mdi:eye-outline",label:"Watched Users",value:((U=e==null?void 0:e.watchedUsers)==null?void 0:U.length)??0},{icon:"mdi:thumb-up-outline",label:"Votes",value:((L=e==null?void 0:e.votes)==null?void 0:L.length)??0},{icon:"mdi:calendar-plus",label:"Created At",value:A(new Date(e==null?void 0:e.createdAt),"PP")}].filter(i=>!!i).map((i,y)=>t.jsxs(b,{display:"flex",alignItems:"center",gap:1,children:[t.jsx(G,{icon:i==null?void 0:i.icon,width:20,color:"text.secondary"}),t.jsxs(C,{variant:"subtitle2",color:"text.secondary",children:[i==null?void 0:i.label,":"]}),t.jsx(C,{variant:"body2",color:"text.primary",sx:{gridColumn:"span 2"},children:i==null?void 0:i.value})]},y))})]}),t.jsx(w,{sx:{justifyContent:"center",pb:2},children:t.jsx(ee,{onClick:v,color:"primary",variant:"outlined",children:"Close"})})]}),t.jsxs(I,{hover:!0,tabIndex:-1,role:"checkbox",selected:a,children:[t.jsx(p,{padding:"checkbox"}),t.jsx(p,{component:"th",scope:"row",children:t.jsx(b,{gap:2,display:"flex",alignItems:"center",children:t.jsx(b,{sx:{width:40,height:40,borderRadius:"50%",overflow:"visible",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}},onClick:()=>{var i,y;return s(`${k}${(y=(i=e.files)==null?void 0:i[0])==null?void 0:y.file}`)},children:t.jsx(q,{src:`${k}${(z=(_=e==null?void 0:e.files)==null?void 0:_[0])==null?void 0:z.file}`,sx:{width:"120%",height:"120%"}})})})}),t.jsx(p,{children:(e==null?void 0:e.fileType)||"N/A"}),t.jsx(p,{children:(e==null?void 0:e.content.slice(0,30))||"N/A"}),t.jsx(p,{children:((H=e==null?void 0:e.userId)==null?void 0:H.name)||"N/A"}),t.jsx(p,{children:A(new Date(e==null?void 0:e.createdAt),"PP")}),t.jsx(p,{align:"right",children:t.jsx(te,{onClick:r,children:t.jsx(G,{icon:"eva:more-vertical-fill"})})})]}),t.jsx(ne,{open:!!d,anchorEl:d,onClose:x,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsxs(se,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${K.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${K.selected}`]:{bgcolor:"action.selected"}}},children:[t.jsx(Y,{onClick:f,children:"View Details"}),t.jsx(Y,{onClick:()=>P(e==null?void 0:e._id),sx:{color:"error.main"},children:"Delete"})]})}),t.jsx(Q,{open:T,onClose:m,maxWidth:"md",fullWidth:!0,children:t.jsx(V,{sx:{p:0,bgcolor:"black"},children:t.jsx("img",{src:o||void 0,alt:"Post Preview",style:{width:"100%",maxHeight:"80vh",objectFit:"contain",display:"block",margin:"auto"},onClick:m})})})]})}const fe={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function ye(e,a,n){return e?Math.max(0,(1+e)*a-n):0}function J(e,a,n){return a[n]<e[n]?-1:a[n]>e[n]?1:0}function ve(e,a){return e==="desc"?(n,u)=>J(n,u,a):(n,u)=>-J(n,u,a)}function Pe({inputData:e,comparator:a,filterName:n}){const u=e.map((d,g)=>[d,g]);return u.sort((d,g)=>{const h=a(d[0],g[0]);return h!==0?h:d[1]-g[1]}),e=u.map(d=>d[0]),n&&(e=e.filter(d=>d.name.toLowerCase().indexOf(n.toLowerCase())!==-1)),e}function Ce({order:e,onSort:a,orderBy:n,rowCount:u,headLabel:d,numSelected:g,onSelectAllRows:h}){return t.jsx(ae,{children:t.jsxs(I,{children:[t.jsx(p,{padding:"checkbox"}),d.map(c=>t.jsx(p,{align:c.align||"left",sortDirection:n===c.id?e:!1,sx:{width:c.width,minWidth:c.minWidth},children:t.jsxs(le,{hideSortIcon:!0,active:n===c.id,direction:n===c.id?e:"asc",onClick:()=>a(c.id),children:[c.label,n===c.id?t.jsx(b,{sx:{...fe},children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},c.id))]})})}function Se({emptyRows:e,height:a,sx:n,...u}){return e?t.jsx(I,{sx:{...a&&{height:a*e},...n},...u,children:t.jsx(p,{colSpan:9})}):null}function Te(){const[e,a]=l.useState([]),[n,u]=l.useState(0),d=async()=>{var m,r,x,P;const s=await X.get("/admin/getAllPost");a((r=(m=s==null?void 0:s.data)==null?void 0:m.data)==null?void 0:r.response),u((P=(x=s==null?void 0:s.data)==null?void 0:x.data)==null?void 0:P.total)},{data:g,error:h,isLoading:c}=ie({queryKey:["/admin/getAllPost"],queryFn:d}),o=ke(),[j,T]=l.useState("");if(c)return t.jsx(b,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:t.jsx(oe,{})});const v=!Pe({inputData:e,comparator:ve(o.order,o.orderBy),filterName:j}).length&&!!j,f=s=>{a(m=>m.filter(r=>r._id!==s))};return t.jsx(ce,{children:t.jsxs(re,{children:[t.jsx(de,{children:t.jsx(ue,{sx:{overflow:"unset"},children:t.jsxs(he,{sx:{minWidth:800},children:[t.jsx(Ce,{order:o.order,orderBy:o.orderBy,rowCount:R.length,numSelected:o.selected.length,onSort:o.onSort,onSelectAllRows:s=>o.onSelectAllRows(s,R.map(m=>m.id)),headLabel:[{id:"files",label:"Image"},{id:"type",label:"Type"},{id:"content",label:"Content"},{id:"username",label:"Username"},{id:"createdAt",label:"Create Time"},{id:""}]}),t.jsxs(xe,{children:[e.map(s=>t.jsx(je,{row:s,selected:o.selected.includes(s==null?void 0:s._id),onSelectRow:()=>o.onSelectRow(s==null?void 0:s._id),onDeletePost:f},s==null?void 0:s._id)),t.jsx(Se,{height:68,emptyRows:ye(o.page,o.rowsPerPage,R.length)}),v&&t.jsx(be,{searchQuery:j})]})]})})}),t.jsx(ge,{component:"div",page:o.page,count:n,rowsPerPage:o.rowsPerPage,onPageChange:o.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:o.onChangeRowsPerPage})]})})}function ke(){const[e,a]=l.useState(0),[n,u]=l.useState("name"),[d,g]=l.useState(5),[h,c]=l.useState([]),[o,j]=l.useState("asc"),T=l.useCallback(r=>{j(n===r&&o==="asc"?"desc":"asc"),u(r)},[o,n]),S=l.useCallback((r,x)=>{if(r){c(x);return}c([])},[]),v=l.useCallback(r=>{const x=h.includes(r)?h.filter(P=>P!==r):[...h,r];c(x)},[h]),f=l.useCallback(()=>{a(0)},[]),s=l.useCallback((r,x)=>{a(x)},[]),m=l.useCallback(r=>{g(parseInt(r.target.value,10)),f()},[f]);return{page:e,order:o,onSort:T,orderBy:n,selected:h,rowsPerPage:d,onSelectRow:v,onResetPage:f,onChangePage:s,onSelectAllRows:S,onChangeRowsPerPage:m}}function Re(){return t.jsxs(t.Fragment,{children:[t.jsx(me,{children:t.jsxs("title",{children:[" ",`Users - ${pe.appName}`]})}),t.jsx(Te,{})]})}export{Re as default};
