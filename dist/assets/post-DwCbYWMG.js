import{j as t,N as I,O as p,B as b,T as C,r as l,F as Z,P as Q,Q as w,R as q,V as k,U as Y,a9 as A,M as G,W as ee,L as te,X as ne,Y as se,Z as ae,$ as J,a0 as K,a1 as le,a2 as ie,A as ce,J as oe,E as de,C as re,a3 as ue,a4 as he,a5 as xe,a6 as R,a7 as ge,a8 as me,H as pe}from"./index-VXCy8LfI.js";import{C as be}from"./config-global-CsQpxj4K.js";function fe({searchQuery:e,...a}){return t.jsx(I,{...a,children:t.jsx(p,{align:"center",colSpan:7,children:t.jsxs(b,{sx:{py:15,textAlign:"center"},children:[t.jsx(C,{variant:"h6",sx:{mb:1},children:"Not found"}),t.jsxs(C,{variant:"body2",children:["No results found for  ",t.jsxs("strong",{children:['"',e,'"']}),".",t.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function je({row:e,selected:a,onSelectRow:n,onDeletePost:u}){var D,N,O,$,E,M,W,F,U,L,_,z,H,B;const[r,g]=l.useState(null),[h,o]=l.useState(!1);l.useState(e.content);const[c,f]=l.useState(null),[T,S]=l.useState(!1),v=()=>{x(),o(!1)},j=()=>o(!0);l.useState(null),l.useState(null);const s=i=>{f(i),S(!0)},m=()=>{S(!1),f(null)},d=l.useCallback(i=>{g(i.currentTarget)},[]),x=l.useCallback(()=>{g(null)},[]),P=l.useCallback(async i=>{if(window.confirm("Are you sure you want to delete the post"))try{const V=await Z.delete(`/api/post?id=${i}`);u(i)}catch(V){console.error("Error deleting post:",V)}},[u]);return t.jsxs(t.Fragment,{children:[t.jsxs(Q,{open:h,onClose:v,fullWidth:!0,maxWidth:"sm",children:[t.jsx(w,{sx:{textAlign:"center",fontWeight:"bold",fontSize:"1.5rem"},children:"👁️ View Post"}),t.jsxs(q,{dividers:!0,sx:{overflowY:"auto",maxHeight:"600px","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",px:3,py:4},children:[t.jsx(b,{sx:{display:"flex",justifyContent:"center",mb:3},children:((N=(D=e==null?void 0:e.files)==null?void 0:D[0])==null?void 0:N.type)==="video"?t.jsx(b,{component:"video",src:`${k}${($=(O=e==null?void 0:e.files)==null?void 0:O[0])==null?void 0:$.file}`,controls:!0,preload:"metadata",onError:i=>{const y=i.target;y.style.display="none"},sx:{width:160,height:160,borderRadius:2,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1},"&::-webkit-media-controls":{display:"none"}}}):t.jsx(Y,{src:`${k}${(M=(E=e==null?void 0:e.files)==null?void 0:E[0])==null?void 0:M.file}`,alt:"Post Image",variant:"rounded",sx:{width:160,height:160,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}}})}),t.jsx(C,{variant:"subtitle1",fontWeight:"bold",mb:1,children:"Content:"}),t.jsx(C,{variant:"body1",mb:3,children:e.content||"N/A"}),t.jsx(b,{sx:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:2,backgroundColor:"#f5f5f5",borderRadius:2,p:3,boxShadow:1},children:[{icon:"mdi:tag-outline",label:"Category",value:((W=e==null?void 0:e.categoryId)==null?void 0:W.name)||(e==null?void 0:e.categoryId)},{icon:"mdi:earth",label:"Country",value:e!=null&&e.country&&(e==null?void 0:e.country.trim())!==""?e==null?void 0:e.country:"N/A"},{icon:"mdi:account",label:"Name",value:((F=e==null?void 0:e.userId)==null?void 0:F.name)||"N/A"},e.startTime&&{icon:"mdi:clock-start",label:"Start Time",value:A(new Date(e==null?void 0:e.startTime),"PPpp")},e.endTime&&{icon:"mdi:clock-end",label:"End Time",value:A(new Date(e==null?void 0:e.endTime),"PPpp")},e.duration&&{icon:"mdi:timer-outline",label:"Duration",value:`${e==null?void 0:e.duration} seconds`},{icon:"mdi:eye-outline",label:(e==null?void 0:e.fileType)==="poll"?"Voted Users":"Watched Users",value:(e==null?void 0:e.fileType)==="poll"?((U=e==null?void 0:e.votes)==null?void 0:U.length)??0:((L=e==null?void 0:e.watchedUsers)==null?void 0:L.length)??0},{icon:"mdi:thumb-up-outline",label:"Votes",value:((_=e==null?void 0:e.votes)==null?void 0:_.length)??0},{icon:"mdi:calendar-plus",label:"Created At",value:A(new Date(e==null?void 0:e.createdAt),"PP")}].filter(i=>!!i).map((i,y)=>t.jsxs(b,{display:"flex",alignItems:"center",gap:1,children:[t.jsx(G,{icon:i==null?void 0:i.icon,width:20,color:"text.secondary"}),t.jsxs(C,{variant:"subtitle2",color:"text.secondary",children:[i==null?void 0:i.label,":"]}),t.jsx(C,{variant:"body2",color:"text.primary",sx:{gridColumn:"span 2"},children:i==null?void 0:i.value})]},y))})]}),t.jsx(ee,{sx:{justifyContent:"center",pb:2},children:t.jsx(te,{onClick:v,color:"primary",variant:"outlined",children:"Close"})})]}),t.jsxs(I,{hover:!0,tabIndex:-1,role:"checkbox",selected:a,children:[t.jsx(p,{padding:"checkbox"}),t.jsx(p,{component:"th",scope:"row",children:t.jsx(b,{gap:2,display:"flex",alignItems:"center",children:t.jsx(b,{sx:{width:40,height:40,borderRadius:"50%",overflow:"visible",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}},onClick:()=>{var i,y;return s(`${k}${(y=(i=e.files)==null?void 0:i[0])==null?void 0:y.file}`)},children:t.jsx(Y,{src:`${k}${(H=(z=e==null?void 0:e.files)==null?void 0:z[0])==null?void 0:H.file}`,sx:{width:"120%",height:"120%"}})})})}),t.jsx(p,{children:(e==null?void 0:e.fileType)||"N/A"}),t.jsx(p,{children:(e==null?void 0:e.content.slice(0,30))||"N/A"}),t.jsx(p,{children:((B=e==null?void 0:e.userId)==null?void 0:B.name)||"N/A"}),t.jsx(p,{children:A(new Date(e==null?void 0:e.createdAt),"PP")}),t.jsx(p,{align:"right",children:t.jsx(ne,{onClick:d,children:t.jsx(G,{icon:"eva:more-vertical-fill"})})})]}),t.jsx(se,{open:!!r,anchorEl:r,onClose:x,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsxs(ae,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${J.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${J.selected}`]:{bgcolor:"action.selected"}}},children:[t.jsx(K,{onClick:j,children:"View Details"}),t.jsx(K,{onClick:()=>P(e==null?void 0:e._id),sx:{color:"error.main"},children:"Delete"})]})}),t.jsx(Q,{open:T,onClose:m,maxWidth:"md",fullWidth:!0,children:t.jsx(q,{sx:{p:0,bgcolor:"black"},children:t.jsx("img",{src:c||void 0,alt:"Post Preview",style:{width:"100%",maxHeight:"80vh",objectFit:"contain",display:"block",margin:"auto"},onClick:m})})})]})}const ye={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function ve(e,a,n){return e?Math.max(0,(1+e)*a-n):0}function X(e,a,n){return a[n]<e[n]?-1:a[n]>e[n]?1:0}function Pe(e,a){return e==="desc"?(n,u)=>X(n,u,a):(n,u)=>-X(n,u,a)}function Ce({inputData:e,comparator:a,filterName:n}){const u=e.map((r,g)=>[r,g]);return u.sort((r,g)=>{const h=a(r[0],g[0]);return h!==0?h:r[1]-g[1]}),e=u.map(r=>r[0]),n&&(e=e.filter(r=>r.name.toLowerCase().indexOf(n.toLowerCase())!==-1)),e}function Se({order:e,onSort:a,orderBy:n,rowCount:u,headLabel:r,numSelected:g,onSelectAllRows:h}){return t.jsx(le,{children:t.jsxs(I,{children:[t.jsx(p,{padding:"checkbox"}),r.map(o=>t.jsx(p,{align:o.align||"left",sortDirection:n===o.id?e:!1,sx:{width:o.width,minWidth:o.minWidth},children:t.jsxs(ie,{hideSortIcon:!0,active:n===o.id,direction:n===o.id?e:"asc",onClick:()=>a(o.id),children:[o.label,n===o.id?t.jsx(b,{sx:{...ye},children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},o.id))]})})}function Te({emptyRows:e,height:a,sx:n,...u}){return e?t.jsx(I,{sx:{...a&&{height:a*e},...n},...u,children:t.jsx(p,{colSpan:9})}):null}function ke(){const[e,a]=l.useState([]),[n,u]=l.useState(0),r=async()=>{var m,d,x,P;const s=await Z.get("/admin/getAllPost");a((d=(m=s==null?void 0:s.data)==null?void 0:m.data)==null?void 0:d.response),u((P=(x=s==null?void 0:s.data)==null?void 0:x.data)==null?void 0:P.total)},{data:g,error:h,isLoading:o}=ce({queryKey:["/admin/getAllPost"],queryFn:r}),c=Ae(),[f,T]=l.useState("");if(o)return t.jsx(b,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:t.jsx(oe,{})});const v=!Ce({inputData:e,comparator:Pe(c.order,c.orderBy),filterName:f}).length&&!!f,j=s=>{a(m=>m.filter(d=>d._id!==s))};return t.jsx(de,{children:t.jsxs(re,{children:[t.jsx(ue,{children:t.jsx(he,{sx:{overflow:"unset"},children:t.jsxs(xe,{sx:{minWidth:800},children:[t.jsx(Se,{order:c.order,orderBy:c.orderBy,rowCount:R.length,numSelected:c.selected.length,onSort:c.onSort,onSelectAllRows:s=>c.onSelectAllRows(s,R.map(m=>m.id)),headLabel:[{id:"files",label:"Image"},{id:"type",label:"Type"},{id:"content",label:"Content"},{id:"username",label:"Username"},{id:"createdAt",label:"Create Time"},{id:""}]}),t.jsxs(ge,{children:[e.map(s=>t.jsx(je,{row:s,selected:c.selected.includes(s==null?void 0:s._id),onSelectRow:()=>c.onSelectRow(s==null?void 0:s._id),onDeletePost:j},s==null?void 0:s._id)),t.jsx(Te,{height:68,emptyRows:ve(c.page,c.rowsPerPage,R.length)}),v&&t.jsx(fe,{searchQuery:f})]})]})})}),t.jsx(me,{component:"div",page:c.page,count:n,rowsPerPage:c.rowsPerPage,onPageChange:c.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:c.onChangeRowsPerPage})]})})}function Ae(){const[e,a]=l.useState(0),[n,u]=l.useState("name"),[r,g]=l.useState(5),[h,o]=l.useState([]),[c,f]=l.useState("asc"),T=l.useCallback(d=>{f(n===d&&c==="asc"?"desc":"asc"),u(d)},[c,n]),S=l.useCallback((d,x)=>{if(d){o(x);return}o([])},[]),v=l.useCallback(d=>{const x=h.includes(d)?h.filter(P=>P!==d):[...h,d];o(x)},[h]),j=l.useCallback(()=>{a(0)},[]),s=l.useCallback((d,x)=>{a(x)},[]),m=l.useCallback(d=>{g(parseInt(d.target.value,10)),j()},[j]);return{page:e,order:c,onSort:T,orderBy:n,selected:h,rowsPerPage:r,onSelectRow:v,onResetPage:j,onChangePage:s,onSelectAllRows:S,onChangeRowsPerPage:m}}function De(){return t.jsxs(t.Fragment,{children:[t.jsx(pe,{children:t.jsxs("title",{children:[" ",`Users - ${be.appName}`]})}),t.jsx(ke,{})]})}export{De as default};
