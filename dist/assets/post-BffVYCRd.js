import{v as de,a9 as se,_ as P,r as i,w as pe,b as me,aa as ue,T as h,j as t,d as xe,h as he,ab as be,k as je,t as Ce,N as E,O as j,B as b,F as ge,P as _,Q as ne,R as V,V as D,U as z,ac as F,M as ae,W as ie,L as le,ad as ve,ae as Ie,X as ke,Y as Pe,Z as Se,$ as oe,a0 as ce,a1 as Te,a2 as Ae,J as Re,E as Le,C as Ne,a3 as Ue,a4 as Me,a5 as $e,a6 as B,a7 as We,a8 as De,H as Oe}from"./index-Bo3upPF3.js";import{C as Fe}from"./config-global-CsQpxj4K.js";const Ee=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],_e=e=>{const{classes:s,inset:n,primary:c,secondary:u,dense:x}=e;return he({root:["root",n&&"inset",x&&"dense",c&&u&&"multiline"],primary:["primary"],secondary:["secondary"]},be,s)},Ve=de("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[{[`& .${se.primary}`]:s.primary},{[`& .${se.secondary}`]:s.secondary},s.root,n.inset&&s.inset,n.primary&&n.secondary&&s.multiline,n.dense&&s.dense]}})(({ownerState:e})=>P({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},e.primary&&e.secondary&&{marginTop:6,marginBottom:6},e.inset&&{paddingLeft:56})),ze=i.forwardRef(function(s,n){const c=pe({props:s,name:"MuiListItemText"}),{children:u,className:x,disableTypography:d=!1,inset:p=!1,primary:f,primaryTypographyProps:m,secondary:v,secondaryTypographyProps:S}=c,T=me(c,Ee),{dense:y}=i.useContext(ue);let g=f??u,l=v;const o=P({},c,{disableTypography:d,inset:p,primary:!!g,secondary:!!l,dense:y}),r=_e(o);return g!=null&&g.type!==h&&!d&&(g=t.jsx(h,P({variant:y?"body2":"body1",className:r.primary,component:m!=null&&m.variant?void 0:"span",display:"block"},m,{children:g}))),l!=null&&l.type!==h&&!d&&(l=t.jsx(h,P({variant:"body2",className:r.secondary,color:"text.secondary",display:"block"},S,{children:l}))),t.jsxs(Ve,P({className:xe(r.root,x),ownerState:o,ref:n},T,{children:[g,l]}))});function Be(e){return je("MuiListItemAvatar",e)}Ce("MuiListItemAvatar",["root","alignItemsFlexStart"]);const He=["className"],Qe=e=>{const{alignItems:s,classes:n}=e;return he({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},Be,n)},Ye=de("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,n.alignItems==="flex-start"&&s.alignItemsFlexStart]}})(({ownerState:e})=>P({minWidth:56,flexShrink:0},e.alignItems==="flex-start"&&{marginTop:8})),Ge=i.forwardRef(function(s,n){const c=pe({props:s,name:"MuiListItemAvatar"}),{className:u}=c,x=me(c,He),d=i.useContext(ue),p=P({},c,{alignItems:d.alignItems}),f=Qe(p);return t.jsx(Ye,P({className:xe(f.root,u),ownerState:p,ref:n},x))});function Je({searchQuery:e,...s}){return t.jsx(E,{...s,children:t.jsx(j,{align:"center",colSpan:7,children:t.jsxs(b,{sx:{py:15,textAlign:"center"},children:[t.jsx(h,{variant:"h6",sx:{mb:1},children:"Not found"}),t.jsxs(h,{variant:"body2",children:["No results found for  ",t.jsxs("strong",{children:['"',e,'"']}),".",t.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function Xe({row:e,selected:s,onSelectRow:n,onDeletePost:c}){var H,Q,Y,G,J,X,Z,q,K,w,ee,te;const[u,x]=i.useState(null),[d,p]=i.useState(!1);i.useState(e.content);const[f,m]=i.useState(null),[v,S]=i.useState(!1),[T,y]=i.useState(!1),g=()=>{L(),p(!1)},l=()=>p(!0);i.useState(null),i.useState(null);const o=a=>{m(a),S(!0)},r=()=>{S(!1),m(null)},A=()=>{console.log("Opening voted users modal..."),console.log("Row votes:",e==null?void 0:e.votes),console.log("File type:",e==null?void 0:e.fileType),y(!0)},R=()=>{y(!1)},O=i.useCallback(a=>{x(a.currentTarget)},[]),L=i.useCallback(()=>{x(null)},[]),fe=i.useCallback(async a=>{if(window.confirm("Are you sure you want to delete the post"))try{const k=await ge.delete(`/api/post?id=${a}`);c(a)}catch(k){console.error("Error deleting post:",k)}},[c]);return t.jsxs(t.Fragment,{children:[t.jsxs(_,{open:d,onClose:g,fullWidth:!0,maxWidth:"sm",children:[t.jsx(ne,{sx:{textAlign:"center",fontWeight:"bold",fontSize:"1.5rem"},children:"👁️ View Post"}),t.jsxs(V,{dividers:!0,sx:{overflowY:"auto",maxHeight:"600px","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",px:3,py:4},children:[t.jsx(b,{sx:{display:"flex",justifyContent:"center",mb:3},children:((Q=(H=e==null?void 0:e.files)==null?void 0:H[0])==null?void 0:Q.type)==="video"?t.jsx(b,{component:"video",src:`${D}${(G=(Y=e==null?void 0:e.files)==null?void 0:Y[0])==null?void 0:G.file}`,controls:!0,preload:"metadata",onError:a=>{const I=a.target;I.style.display="none"},sx:{width:160,height:160,borderRadius:2,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1},"&::-webkit-media-controls":{display:"none"}}}):t.jsx(z,{src:`${D}${(X=(J=e==null?void 0:e.files)==null?void 0:J[0])==null?void 0:X.file}`,alt:"Post Image",variant:"rounded",sx:{width:160,height:160,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}}})}),t.jsx(h,{variant:"subtitle1",fontWeight:"bold",mb:1,children:"Content:"}),t.jsx(h,{variant:"body1",mb:3,children:e.content||"N/A"}),t.jsx(b,{sx:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:2,backgroundColor:"#f5f5f5",borderRadius:2,p:3,boxShadow:1},children:(()=>{var k,N,U,M,$,W;const a=(k=e==null?void 0:e.files)==null?void 0:k.some(C=>C.type==="image");return[{icon:"mdi:tag-outline",label:"Category",value:(typeof(e==null?void 0:e.categoryId)=="object"?(N=e==null?void 0:e.categoryId)==null?void 0:N.name:e==null?void 0:e.categoryId)||"N/A",isClickable:!1,onClick:void 0},{icon:"mdi:earth",label:"Country",value:e!=null&&e.country&&(e==null?void 0:e.country.trim())!==""?e==null?void 0:e.country:"N/A",isClickable:!1,onClick:void 0},{icon:"mdi:account",label:"Name",value:((U=e==null?void 0:e.userId)==null?void 0:U.name)||"N/A",isClickable:!1,onClick:void 0},...e.startTime?[{icon:"mdi:clock-start",label:"Start Time",value:F(new Date(e==null?void 0:e.startTime),"PPpp"),isClickable:!1,onClick:void 0}]:[],...e.endTime?[{icon:"mdi:clock-end",label:"End Time",value:F(new Date(e==null?void 0:e.endTime),"PPpp"),isClickable:!1,onClick:void 0}]:[],...e.duration?[{icon:"mdi:timer-outline",label:"Duration",value:`${e==null?void 0:e.duration} seconds`,isClickable:!1,onClick:void 0}]:[],...a?[]:[{icon:"mdi:eye-outline",label:(e==null?void 0:e.fileType)==="poll"?"Voted Users":"Video Count",value:(e==null?void 0:e.fileType)==="poll"?((M=e==null?void 0:e.votes)==null?void 0:M.length)??0:(e==null?void 0:e.videoCount)??0,isClickable:(e==null?void 0:e.fileType)==="poll"&&((($=e==null?void 0:e.votes)==null?void 0:$.length)??0)>0,onClick:(e==null?void 0:e.fileType)==="poll"&&(((W=e==null?void 0:e.votes)==null?void 0:W.length)??0)>0?A:void 0}],{icon:"mdi:calendar-plus",label:"Created At",value:F(new Date(e==null?void 0:e.createdAt),"PP"),isClickable:!1,onClick:void 0}].map((C,ye)=>t.jsxs(b,{display:"flex",alignItems:"center",gap:1,children:[t.jsx(ae,{icon:C.icon,width:20,color:"text.secondary"}),t.jsxs(h,{variant:"subtitle2",color:"text.secondary",children:[C.label,":"]}),t.jsx(h,{variant:"body2",color:C.isClickable?"primary.main":"text.primary",sx:{gridColumn:"span 2",cursor:C.isClickable?"pointer":"default",textDecoration:C.isClickable?"underline":"none","&:hover":C.isClickable?{color:"primary.dark"}:{}},onClick:C.onClick||void 0,children:String(C.value)})]},ye))})()})]}),t.jsx(ie,{sx:{justifyContent:"center",pb:2},children:t.jsx(le,{onClick:g,color:"primary",variant:"outlined",children:"Close"})})]}),t.jsxs(_,{open:T,onClose:R,fullWidth:!0,maxWidth:"sm",children:[t.jsxs(ne,{sx:{textAlign:"center",fontWeight:"bold",fontSize:"1.5rem"},children:["👥 Voted Users (",((Z=e==null?void 0:e.votes)==null?void 0:Z.length)??0,")"]}),t.jsx(V,{dividers:!0,sx:{p:0},children:((q=e==null?void 0:e.votes)==null?void 0:q.length)>0?t.jsx(ve,{sx:{width:"100%",bgcolor:"background.paper"},children:(K=e==null?void 0:e.votes)==null?void 0:K.map((a,I)=>{var k,N,U,M,$,W;return t.jsxs(Ie,{sx:{borderBottom:I<e.votes.length-1?"1px solid #f0f0f0":"none",py:2},children:[t.jsx(Ge,{children:t.jsx(z,{src:(k=a==null?void 0:a.userId)!=null&&k.image?`${D}${a.userId.image}`:void 0,sx:{width:50,height:50},children:((M=(U=(N=a==null?void 0:a.userId)==null?void 0:N.name)==null?void 0:U.charAt(0))==null?void 0:M.toUpperCase())||"U"})}),t.jsx(ze,{primary:t.jsx(h,{variant:"subtitle1",fontWeight:"bold",children:(($=a==null?void 0:a.userId)==null?void 0:$.name)||"Unknown User"}),secondary:t.jsxs(b,{children:[t.jsx(h,{variant:"body2",color:"text.secondary",children:((W=a==null?void 0:a.userId)==null?void 0:W.email)||"No email"}),(a==null?void 0:a.option)&&t.jsxs(h,{variant:"caption",color:"primary.main",sx:{fontWeight:"bold"},children:["Voted for: ",a.option.name]})]})})]},a._id||I)})}):t.jsx(b,{sx:{textAlign:"center",py:4},children:t.jsx(h,{variant:"h6",color:"text.secondary",children:"No votes yet"})})}),t.jsx(ie,{sx:{justifyContent:"center",pb:2},children:t.jsx(le,{onClick:R,color:"primary",variant:"outlined",children:"Close"})})]}),t.jsxs(E,{hover:!0,tabIndex:-1,role:"checkbox",selected:s,children:[t.jsx(j,{padding:"checkbox"}),t.jsx(j,{component:"th",scope:"row",children:t.jsx(b,{gap:2,display:"flex",alignItems:"center",children:t.jsx(b,{sx:{width:40,height:40,borderRadius:"50%",overflow:"visible",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}},onClick:()=>{var a,I;return o(`${D}${(I=(a=e.files)==null?void 0:a[0])==null?void 0:I.file}`)},children:t.jsx(z,{src:`${D}${(ee=(w=e==null?void 0:e.files)==null?void 0:w[0])==null?void 0:ee.file}`,sx:{width:"120%",height:"120%"}})})})}),t.jsx(j,{children:(e==null?void 0:e.fileType)||"N/A"}),t.jsx(j,{children:(e==null?void 0:e.content.slice(0,30))||"N/A"}),t.jsx(j,{children:((te=e==null?void 0:e.userId)==null?void 0:te.name)||"N/A"}),t.jsx(j,{children:F(new Date(e==null?void 0:e.createdAt),"PP")}),t.jsx(j,{align:"right",children:t.jsx(ke,{onClick:O,children:t.jsx(ae,{icon:"eva:more-vertical-fill"})})})]}),t.jsx(Pe,{open:!!u,anchorEl:u,onClose:L,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsxs(Se,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${oe.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${oe.selected}`]:{bgcolor:"action.selected"}}},children:[t.jsx(ce,{onClick:l,children:"View Details"}),t.jsx(ce,{onClick:()=>fe(e==null?void 0:e._id),sx:{color:"error.main"},children:"Delete"})]})}),t.jsx(_,{open:v,onClose:r,maxWidth:"md",fullWidth:!0,children:t.jsx(V,{sx:{p:0,bgcolor:"black"},children:t.jsx("img",{src:f||void 0,alt:"Post Preview",style:{width:"100%",maxHeight:"80vh",objectFit:"contain",display:"block",margin:"auto"},onClick:r})})})]})}const Ze={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function qe(e,s,n){return e?Math.max(0,(1+e)*s-n):0}function re(e,s,n){return s[n]<e[n]?-1:s[n]>e[n]?1:0}function Ke(e,s){return e==="desc"?(n,c)=>re(n,c,s):(n,c)=>-re(n,c,s)}function we({inputData:e,comparator:s,filterName:n}){const c=e.map((u,x)=>[u,x]);return c.sort((u,x)=>{const d=s(u[0],x[0]);return d!==0?d:u[1]-x[1]}),e=c.map(u=>u[0]),n&&(e=e.filter(u=>u.name.toLowerCase().indexOf(n.toLowerCase())!==-1)),e}function et({order:e,onSort:s,orderBy:n,rowCount:c,headLabel:u,numSelected:x,onSelectAllRows:d}){return t.jsx(Te,{children:t.jsxs(E,{children:[t.jsx(j,{padding:"checkbox"}),u.map(p=>t.jsx(j,{align:p.align||"left",sortDirection:n===p.id?e:!1,sx:{width:p.width,minWidth:p.minWidth},children:t.jsxs(Ae,{hideSortIcon:!0,active:n===p.id,direction:n===p.id?e:"asc",onClick:()=>s(p.id),children:[p.label,n===p.id?t.jsx(b,{sx:{...Ze},children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},p.id))]})})}function tt({emptyRows:e,height:s,sx:n,...c}){return e?t.jsx(E,{sx:{...s&&{height:s*e},...n},...c,children:t.jsx(j,{colSpan:9})}):null}function st(){const[e,s]=i.useState([]),[n,c]=i.useState(0),[u,x]=i.useState(!1),[d,p]=i.useState({limit:10,page:0}),f=async(l,o)=>{var A,R,O,L;const r=await ge.get(`/admin/getAllPost?limit=${l}&page=${o+1}`);s((R=(A=r==null?void 0:r.data)==null?void 0:A.data)==null?void 0:R.response),c((L=(O=r==null?void 0:r.data)==null?void 0:O.data)==null?void 0:L.total)};i.useEffect(()=>{f(d.limit,d.page)},[d.limit,d.page]);const m=nt(),[v,S]=i.useState("");if(u)return t.jsx(b,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:t.jsx(Re,{})});const y=!we({inputData:e,comparator:Ke(m.order,m.orderBy),filterName:v}).length&&!!v,g=l=>{s(o=>o.filter(r=>r._id!==l))};return t.jsx(Le,{children:t.jsxs(Ne,{children:[t.jsx(Ue,{children:t.jsx(Me,{sx:{overflow:"unset"},children:t.jsxs($e,{sx:{minWidth:800},children:[t.jsx(et,{order:m.order,orderBy:m.orderBy,rowCount:B.length,numSelected:m.selected.length,onSort:m.onSort,onSelectAllRows:l=>m.onSelectAllRows(l,B.map(o=>o.id)),headLabel:[{id:"files",label:"Image"},{id:"type",label:"Type"},{id:"content",label:"Content"},{id:"username",label:"Username"},{id:"createdAt",label:"Create Time"},{id:""}]}),t.jsxs(We,{children:[e.map(l=>t.jsx(Xe,{row:l,selected:m.selected.includes(l==null?void 0:l._id),onSelectRow:()=>m.onSelectRow(l==null?void 0:l._id),onDeletePost:g},l==null?void 0:l._id)),t.jsx(tt,{height:68,emptyRows:qe(m.page,m.rowsPerPage,B.length)}),y&&t.jsx(Je,{searchQuery:v})]})]})})}),t.jsx(De,{component:"div",page:d.page,count:n,rowsPerPage:d.limit,onPageChange:(l,o)=>{p(r=>({...r,page:o})),m.setPage(o)},rowsPerPageOptions:[5,10,25],onRowsPerPageChange:l=>{var r;const o=parseInt(l.target.value,10);p({page:0,limit:o}),(r=m.setRowsPerPage)==null||r.call(m,o)}})]})})}function nt(){const[e,s]=i.useState(0),[n,c]=i.useState("name"),[u,x]=i.useState(5),[d,p]=i.useState([]),[f,m]=i.useState("asc"),v=i.useCallback(o=>{m(n===o&&f==="asc"?"desc":"asc"),c(o)},[f,n]),S=i.useCallback((o,r)=>{if(o){p(r);return}p([])},[]),T=i.useCallback(o=>{const r=d.includes(o)?d.filter(A=>A!==o):[...d,o];p(r)},[d]),y=i.useCallback(()=>{s(0)},[]),g=i.useCallback((o,r)=>{s(r)},[]),l=i.useCallback(o=>{x(parseInt(o.target.value,10)),y()},[y]);return{page:e,order:f,onSort:v,orderBy:n,selected:d,rowsPerPage:u,onSelectRow:T,onResetPage:y,onChangePage:g,onSelectAllRows:S,onChangeRowsPerPage:l,setPage:s,setRowsPerPage:x}}function lt(){return t.jsxs(t.Fragment,{children:[t.jsx(Oe,{children:t.jsxs("title",{children:[" ",`Users - ${Fe.appName}`]})}),t.jsx(st,{})]})}export{lt as default};
