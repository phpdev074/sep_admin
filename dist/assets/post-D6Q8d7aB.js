import{v as ce,a9 as ee,_ as k,r as l,w as re,b as de,aa as ue,T as g,j as t,d as pe,h as me,ab as fe,k as be,t as je,N as $,O as v,B as C,F as he,P as D,Q as te,R as O,V as M,U as F,ac as W,M as se,W as ne,L as ae,ad as Ce,ae as ve,X as Pe,Y as ke,Z as Ie,$ as ie,a0 as le,a1 as Se,a2 as Te,A as Ae,J as Re,E as Le,C as Ue,a3 as Ne,a4 as Me,a5 as We,a6 as _,a7 as $e,a8 as De,H as Oe}from"./index-uaEX2h8I.js";import{C as Fe}from"./config-global-CsQpxj4K.js";const _e=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],Ee=e=>{const{classes:s,inset:n,primary:o,secondary:d,dense:m}=e;return me({root:["root",n&&"inset",m&&"dense",o&&d&&"multiline"],primary:["primary"],secondary:["secondary"]},fe,s)},Ve=ce("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[{[`& .${ee.primary}`]:s.primary},{[`& .${ee.secondary}`]:s.secondary},s.root,n.inset&&s.inset,n.primary&&n.secondary&&s.multiline,n.dense&&s.dense]}})(({ownerState:e})=>k({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},e.primary&&e.secondary&&{marginTop:6,marginBottom:6},e.inset&&{paddingLeft:56})),ze=l.forwardRef(function(s,n){const o=re({props:s,name:"MuiListItemText"}),{children:d,className:m,disableTypography:p=!1,inset:r=!1,primary:c,primaryTypographyProps:y,secondary:T,secondaryTypographyProps:I}=o,S=de(o,_e),{dense:f}=l.useContext(ue);let a=c??d,h=T;const u=k({},o,{disableTypography:p,inset:r,primary:!!a,secondary:!!h,dense:f}),x=Ee(u);return a!=null&&a.type!==g&&!p&&(a=t.jsx(g,k({variant:f?"body2":"body1",className:x.primary,component:y!=null&&y.variant?void 0:"span",display:"block"},y,{children:a}))),h!=null&&h.type!==g&&!p&&(h=t.jsx(g,k({variant:"body2",className:x.secondary,color:"text.secondary",display:"block"},I,{children:h}))),t.jsxs(Ve,k({className:pe(x.root,m),ownerState:u,ref:n},S,{children:[a,h]}))});function Be(e){return be("MuiListItemAvatar",e)}je("MuiListItemAvatar",["root","alignItemsFlexStart"]);const He=["className"],Qe=e=>{const{alignItems:s,classes:n}=e;return me({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},Be,n)},qe=ce("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,n.alignItems==="flex-start"&&s.alignItemsFlexStart]}})(({ownerState:e})=>k({minWidth:56,flexShrink:0},e.alignItems==="flex-start"&&{marginTop:8})),Ye=l.forwardRef(function(s,n){const o=re({props:s,name:"MuiListItemAvatar"}),{className:d}=o,m=de(o,He),p=l.useContext(ue),r=k({},o,{alignItems:p.alignItems}),c=Qe(r);return t.jsx(qe,k({className:pe(c.root,d),ownerState:r,ref:n},m))});function Ge({searchQuery:e,...s}){return t.jsx($,{...s,children:t.jsx(v,{align:"center",colSpan:7,children:t.jsxs(C,{sx:{py:15,textAlign:"center"},children:[t.jsx(g,{variant:"h6",sx:{mb:1},children:"Not found"}),t.jsxs(g,{variant:"body2",children:["No results found for  ",t.jsxs("strong",{children:['"',e,'"']}),".",t.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function Je({row:e,selected:s,onSelectRow:n,onDeletePost:o}){var z,B,H,Q,q,Y,G,J,K,X,Z,w;const[d,m]=l.useState(null),[p,r]=l.useState(!1);l.useState(e.content);const[c,y]=l.useState(null),[T,I]=l.useState(!1),[S,f]=l.useState(!1),a=()=>{V(),r(!1)},h=()=>r(!0);l.useState(null),l.useState(null);const u=i=>{y(i),I(!0)},x=()=>{I(!1),y(null)},A=()=>{console.log("Opening voted users modal..."),console.log("Row votes:",e==null?void 0:e.votes),console.log("File type:",e==null?void 0:e.fileType),f(!0)},E=()=>{f(!1)},xe=l.useCallback(i=>{m(i.currentTarget)},[]),V=l.useCallback(()=>{m(null)},[]),ge=l.useCallback(async i=>{if(window.confirm("Are you sure you want to delete the post"))try{const P=await he.delete(`/api/post?id=${i}`);o(i)}catch(P){console.error("Error deleting post:",P)}},[o]);return t.jsxs(t.Fragment,{children:[t.jsxs(D,{open:p,onClose:a,fullWidth:!0,maxWidth:"sm",children:[t.jsx(te,{sx:{textAlign:"center",fontWeight:"bold",fontSize:"1.5rem"},children:"👁️ View Post"}),t.jsxs(O,{dividers:!0,sx:{overflowY:"auto",maxHeight:"600px","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",px:3,py:4},children:[t.jsx(C,{sx:{display:"flex",justifyContent:"center",mb:3},children:((B=(z=e==null?void 0:e.files)==null?void 0:z[0])==null?void 0:B.type)==="video"?t.jsx(C,{component:"video",src:`${M}${(Q=(H=e==null?void 0:e.files)==null?void 0:H[0])==null?void 0:Q.file}`,controls:!0,preload:"metadata",onError:i=>{const b=i.target;b.style.display="none"},sx:{width:160,height:160,borderRadius:2,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1},"&::-webkit-media-controls":{display:"none"}}}):t.jsx(F,{src:`${M}${(Y=(q=e==null?void 0:e.files)==null?void 0:q[0])==null?void 0:Y.file}`,alt:"Post Image",variant:"rounded",sx:{width:160,height:160,boxShadow:2,border:"2px solid #1976d2",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}}})}),t.jsx(g,{variant:"subtitle1",fontWeight:"bold",mb:1,children:"Content:"}),t.jsx(g,{variant:"body1",mb:3,children:e.content||"N/A"}),t.jsx(C,{sx:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:2,backgroundColor:"#f5f5f5",borderRadius:2,p:3,boxShadow:1},children:(()=>{var b,P,R,L,U,N;return[{icon:"mdi:tag-outline",label:"Category",value:(typeof(e==null?void 0:e.categoryId)=="object"?(b=e==null?void 0:e.categoryId)==null?void 0:b.name:e==null?void 0:e.categoryId)||"N/A",isClickable:!1,onClick:void 0},{icon:"mdi:earth",label:"Country",value:e!=null&&e.country&&(e==null?void 0:e.country.trim())!==""?e==null?void 0:e.country:"N/A",isClickable:!1,onClick:void 0},{icon:"mdi:account",label:"Name",value:((P=e==null?void 0:e.userId)==null?void 0:P.name)||"N/A",isClickable:!1,onClick:void 0},...e.startTime?[{icon:"mdi:clock-start",label:"Start Time",value:W(new Date(e==null?void 0:e.startTime),"PPpp"),isClickable:!1,onClick:void 0}]:[],...e.endTime?[{icon:"mdi:clock-end",label:"End Time",value:W(new Date(e==null?void 0:e.endTime),"PPpp"),isClickable:!1,onClick:void 0}]:[],...e.duration?[{icon:"mdi:timer-outline",label:"Duration",value:`${e==null?void 0:e.duration} seconds`,isClickable:!1,onClick:void 0}]:[],{icon:"mdi:eye-outline",label:(e==null?void 0:e.fileType)==="poll"?"Voted Users":"Watched Users",value:(e==null?void 0:e.fileType)==="poll"?((R=e==null?void 0:e.votes)==null?void 0:R.length)??0:((L=e==null?void 0:e.watchedUsers)==null?void 0:L.length)??0,isClickable:(e==null?void 0:e.fileType)==="poll"&&(((U=e==null?void 0:e.votes)==null?void 0:U.length)??0)>0,onClick:(e==null?void 0:e.fileType)==="poll"&&(((N=e==null?void 0:e.votes)==null?void 0:N.length)??0)>0?A:void 0},{icon:"mdi:calendar-plus",label:"Created At",value:W(new Date(e==null?void 0:e.createdAt),"PP"),isClickable:!1,onClick:void 0}].map((j,ye)=>t.jsxs(C,{display:"flex",alignItems:"center",gap:1,children:[t.jsx(se,{icon:j.icon,width:20,color:"text.secondary"}),t.jsxs(g,{variant:"subtitle2",color:"text.secondary",children:[j.label,":"]}),t.jsx(g,{variant:"body2",color:j.isClickable?"primary.main":"text.primary",sx:{gridColumn:"span 2",cursor:j.isClickable?"pointer":"default",textDecoration:j.isClickable?"underline":"none","&:hover":j.isClickable?{color:"primary.dark"}:{}},onClick:j.onClick||void 0,children:String(j.value)})]},ye))})()})]}),t.jsx(ne,{sx:{justifyContent:"center",pb:2},children:t.jsx(ae,{onClick:a,color:"primary",variant:"outlined",children:"Close"})})]}),t.jsxs(D,{open:S,onClose:E,fullWidth:!0,maxWidth:"sm",children:[t.jsxs(te,{sx:{textAlign:"center",fontWeight:"bold",fontSize:"1.5rem"},children:["👥 Voted Users (",((G=e==null?void 0:e.votes)==null?void 0:G.length)??0,")"]}),t.jsx(O,{dividers:!0,sx:{p:0},children:((J=e==null?void 0:e.votes)==null?void 0:J.length)>0?t.jsx(Ce,{sx:{width:"100%",bgcolor:"background.paper"},children:(K=e==null?void 0:e.votes)==null?void 0:K.map((i,b)=>{var P,R,L,U,N,j;return t.jsxs(ve,{sx:{borderBottom:b<e.votes.length-1?"1px solid #f0f0f0":"none",py:2},children:[t.jsx(Ye,{children:t.jsx(F,{src:(P=i==null?void 0:i.userId)!=null&&P.image?`${M}${i.userId.image}`:void 0,sx:{width:50,height:50},children:((U=(L=(R=i==null?void 0:i.userId)==null?void 0:R.name)==null?void 0:L.charAt(0))==null?void 0:U.toUpperCase())||"U"})}),t.jsx(ze,{primary:t.jsx(g,{variant:"subtitle1",fontWeight:"bold",children:((N=i==null?void 0:i.userId)==null?void 0:N.name)||"Unknown User"}),secondary:t.jsxs(C,{children:[t.jsx(g,{variant:"body2",color:"text.secondary",children:((j=i==null?void 0:i.userId)==null?void 0:j.email)||"No email"}),(i==null?void 0:i.option)&&t.jsxs(g,{variant:"caption",color:"primary.main",sx:{fontWeight:"bold"},children:["Voted for: ",i.option.name]})]})})]},i._id||b)})}):t.jsx(C,{sx:{textAlign:"center",py:4},children:t.jsx(g,{variant:"h6",color:"text.secondary",children:"No votes yet"})})}),t.jsx(ne,{sx:{justifyContent:"center",pb:2},children:t.jsx(ae,{onClick:E,color:"primary",variant:"outlined",children:"Close"})})]}),t.jsxs($,{hover:!0,tabIndex:-1,role:"checkbox",selected:s,children:[t.jsx(v,{padding:"checkbox"}),t.jsx(v,{component:"th",scope:"row",children:t.jsx(C,{gap:2,display:"flex",alignItems:"center",children:t.jsx(C,{sx:{width:40,height:40,borderRadius:"50%",overflow:"visible",cursor:"pointer",transition:"transform 0.4s ease-in-out","&:hover":{transform:"scale(1.3)",zIndex:1}},onClick:()=>{var i,b;return u(`${M}${(b=(i=e.files)==null?void 0:i[0])==null?void 0:b.file}`)},children:t.jsx(F,{src:`${M}${(Z=(X=e==null?void 0:e.files)==null?void 0:X[0])==null?void 0:Z.file}`,sx:{width:"120%",height:"120%"}})})})}),t.jsx(v,{children:(e==null?void 0:e.fileType)||"N/A"}),t.jsx(v,{children:(e==null?void 0:e.content.slice(0,30))||"N/A"}),t.jsx(v,{children:((w=e==null?void 0:e.userId)==null?void 0:w.name)||"N/A"}),t.jsx(v,{children:W(new Date(e==null?void 0:e.createdAt),"PP")}),t.jsx(v,{align:"right",children:t.jsx(Pe,{onClick:xe,children:t.jsx(se,{icon:"eva:more-vertical-fill"})})})]}),t.jsx(ke,{open:!!d,anchorEl:d,onClose:V,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsxs(Ie,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${ie.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${ie.selected}`]:{bgcolor:"action.selected"}}},children:[t.jsx(le,{onClick:h,children:"View Details"}),t.jsx(le,{onClick:()=>ge(e==null?void 0:e._id),sx:{color:"error.main"},children:"Delete"})]})}),t.jsx(D,{open:T,onClose:x,maxWidth:"md",fullWidth:!0,children:t.jsx(O,{sx:{p:0,bgcolor:"black"},children:t.jsx("img",{src:c||void 0,alt:"Post Preview",style:{width:"100%",maxHeight:"80vh",objectFit:"contain",display:"block",margin:"auto"},onClick:x})})})]})}const Ke={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Xe(e,s,n){return e?Math.max(0,(1+e)*s-n):0}function oe(e,s,n){return s[n]<e[n]?-1:s[n]>e[n]?1:0}function Ze(e,s){return e==="desc"?(n,o)=>oe(n,o,s):(n,o)=>-oe(n,o,s)}function we({inputData:e,comparator:s,filterName:n}){const o=e.map((d,m)=>[d,m]);return o.sort((d,m)=>{const p=s(d[0],m[0]);return p!==0?p:d[1]-m[1]}),e=o.map(d=>d[0]),n&&(e=e.filter(d=>d.name.toLowerCase().indexOf(n.toLowerCase())!==-1)),e}function et({order:e,onSort:s,orderBy:n,rowCount:o,headLabel:d,numSelected:m,onSelectAllRows:p}){return t.jsx(Se,{children:t.jsxs($,{children:[t.jsx(v,{padding:"checkbox"}),d.map(r=>t.jsx(v,{align:r.align||"left",sortDirection:n===r.id?e:!1,sx:{width:r.width,minWidth:r.minWidth},children:t.jsxs(Te,{hideSortIcon:!0,active:n===r.id,direction:n===r.id?e:"asc",onClick:()=>s(r.id),children:[r.label,n===r.id?t.jsx(C,{sx:{...Ke},children:e==="desc"?"sorted descending":"sorted ascending"}):null]})},r.id))]})})}function tt({emptyRows:e,height:s,sx:n,...o}){return e?t.jsx($,{sx:{...s&&{height:s*e},...n},...o,children:t.jsx(v,{colSpan:9})}):null}function st(){const[e,s]=l.useState([]),[n,o]=l.useState(0),d=async()=>{var h,u,x,A;const a=await he.get("/admin/getAllPost");s((u=(h=a==null?void 0:a.data)==null?void 0:h.data)==null?void 0:u.response),o((A=(x=a==null?void 0:a.data)==null?void 0:x.data)==null?void 0:A.total)},{data:m,error:p,isLoading:r}=Ae({queryKey:["/admin/getAllPost"],queryFn:d}),c=nt(),[y,T]=l.useState("");if(r)return t.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:t.jsx(Re,{})});const S=!we({inputData:e,comparator:Ze(c.order,c.orderBy),filterName:y}).length&&!!y,f=a=>{s(h=>h.filter(u=>u._id!==a))};return t.jsx(Le,{children:t.jsxs(Ue,{children:[t.jsx(Ne,{children:t.jsx(Me,{sx:{overflow:"unset"},children:t.jsxs(We,{sx:{minWidth:800},children:[t.jsx(et,{order:c.order,orderBy:c.orderBy,rowCount:_.length,numSelected:c.selected.length,onSort:c.onSort,onSelectAllRows:a=>c.onSelectAllRows(a,_.map(h=>h.id)),headLabel:[{id:"files",label:"Image"},{id:"type",label:"Type"},{id:"content",label:"Content"},{id:"username",label:"Username"},{id:"createdAt",label:"Create Time"},{id:""}]}),t.jsxs($e,{children:[e.map(a=>t.jsx(Je,{row:a,selected:c.selected.includes(a==null?void 0:a._id),onSelectRow:()=>c.onSelectRow(a==null?void 0:a._id),onDeletePost:f},a==null?void 0:a._id)),t.jsx(tt,{height:68,emptyRows:Xe(c.page,c.rowsPerPage,_.length)}),S&&t.jsx(Ge,{searchQuery:y})]})]})})}),t.jsx(De,{component:"div",page:c.page,count:n,rowsPerPage:c.rowsPerPage,onPageChange:c.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:c.onChangeRowsPerPage})]})})}function nt(){const[e,s]=l.useState(0),[n,o]=l.useState("name"),[d,m]=l.useState(5),[p,r]=l.useState([]),[c,y]=l.useState("asc"),T=l.useCallback(u=>{y(n===u&&c==="asc"?"desc":"asc"),o(u)},[c,n]),I=l.useCallback((u,x)=>{if(u){r(x);return}r([])},[]),S=l.useCallback(u=>{const x=p.includes(u)?p.filter(A=>A!==u):[...p,u];r(x)},[p]),f=l.useCallback(()=>{s(0)},[]),a=l.useCallback((u,x)=>{s(x)},[]),h=l.useCallback(u=>{m(parseInt(u.target.value,10)),f()},[f]);return{page:e,order:c,onSort:T,orderBy:n,selected:p,rowsPerPage:d,onSelectRow:S,onResetPage:f,onChangePage:a,onSelectAllRows:I,onChangeRowsPerPage:h}}function lt(){return t.jsxs(t.Fragment,{children:[t.jsx(Oe,{children:t.jsxs("title",{children:[" ",`Users - ${Fe.appName}`]})}),t.jsx(st,{})]})}export{lt as default};
